---
title: "circosplot"
output: html_document
---
```{r}
rm(list=ls())
options(stringsAsFactors = FALSE)
library(Homo.sapiens)
library(OmicCircos)

locations<-genes(Homo.sapiens, columns=c("SYMBOL", "ENSEMBL"))
locations<-as.data.frame(locations)
locations<-locations[!is.na(locations[,'SYMBOL']), ]
locations<-locations[!duplicated(locations[,'SYMBOL']), ]

d<-read.csv(file = 'E:/data_melanoma/net_mapped_with_gepia.csv',header = TRUE)
Circos.Data <- d[,c("hgnc_symbol","ensembl","Total_Number_of_Mutations","Number_of_Samples_Mutations","Percentage_of_Samples_Mutations","CNA","Number_of_Samples_CNA","Percentage_of_Samples_CNA","Median_Tumor","Median_Normal","log2FoldChange","adjp")]
Circos.Data<-Circos.Data[!duplicated(Circos.Data),]
tp_ind1a<-which(d$hgnc_symbol %in% locations$SYMBOL==F)
tp_ind1b<-which(d$ensembl %in% locations$ENSEMBL==F)
tp_ind1<-intersect(tp_ind1a,tp_ind1b)
Circos.Data<-Circos.Data[-tp_ind1,]
Circos.Data<-merge(Circos.Data,locations,by.x = "hgnc_symbol",by.y = "SYMBOL",all.x=T)

Plot.Circos.Data<-Circos.Data[which(abs(Circos.Data$log2FoldChange)>=1),]
Plot.Circos.Data<-Plot.Circos.Data[!duplicated(Plot.Circos.Data),]
Plot.Circos.Data<-Plot.Circos.Data[!is.na(Plot.Circos.Data$seqnames),]

label<-Plot.Circos.Data[,c("seqnames","start","hgnc_symbol","hgnc_symbol")]

gene.exp<-Plot.Circos.Data[,c("seqnames","start","hgnc_symbol","log2FoldChange")]
gene.exp$log2FoldChange=gene.exp$log2FoldChange/max(abs(gene.exp$log2FoldChange))

gene.mutations<-Plot.Circos.Data[,c("seqnames","start","hgnc_symbol","Number_of_Samples_Mutations")]
gene.mutations$Number_of_Samples_Mutations[is.na(gene.mutations$Number_of_Samples_Mutations)]=0

gene.cna<-Plot.Circos.Data[,c("seqnames","start","hgnc_symbol","Number_of_Samples_CNA")]
gene.cna$Number_of_Samples_CNA[is.na(gene.cna$Number_of_Samples_CNA)]=0

gene.adjp<-Plot.Circos.Data[,c("seqnames","start","hgnc_symbol","adjp")]

colors<-rainbow(10,alpha = 0.5);
pdffile  <- "Circos_melanoma1.pdf";
pdf(pdffile, 8, 8);
par(mar = c(2, 2, 2, 2));
plot(c(1,800), c(1,800), type="n", axes=FALSE, xlab="", ylab="", main="");
circos(R = 350,cir = "hg19",W = 4,type = "chr",print.chr.lab = TRUE,scale = TRUE);#最外层染色体信息
circos(R = 360,cir = "hg19",W = 20,mapping = label,type = "label",side = "out",col = c("black","blue","red"),cex = 0.4)#标签
circos(R = 260,cir = "hg19",W = 50,mapping = gene.exp,col.v = 4,type = "heatmap",B = FALSE,lwd = 2);#次外层基因表达信息
circos(R = 200,cir = "HG19",W = 50,mapping = gene.mutations,col.v = 4,type = "l",B = FALSE,col = colors[3],lwd = 2,cutoff = 0)#第三层基因突变信息
circos(R = 150,cir = "hg19",W = 80,mapping = gene.cna,col.v = 4,type = "l",B = FALSE,col = colors[2],lwd = 2,cutoff = 0);#第四层CNA信息
circos(R = 100,cir = "hg19",W = 80,mapping = gene.adjp,col.v = 4,type = "l",B = FALSE,col = colors[1],lwd = 1);#第五层p值曲线
dev.off()
```

